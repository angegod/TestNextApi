(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{1233:(e,a,t)=>{"use strict";t.d(a,{default:()=>j});var s=t(5155),r=t(2115),l=t(2540),i=t(7665);t(9193);var n=t(3464),c=t(5424),o=t(5695),x=t(9796),d=t(9779);let h=r.memo(()=>{let{historyData:e}=(0,r.useContext)(d.A);if(0===e.length)return(0,s.jsx)(s.Fragment,{});{let a=e.map((e,a)=>(0,s.jsx)(x.r,{index:a,data:e},"history"+a));return(0,s.jsx)(s.Fragment,{children:a})}});var m=t(7901),p=t(8390),f=t(2887),u=t(3848),v=t(4422);let w=function(){return(0,s.jsxs)("div",{className:"w-[300px] flex flex-col max-[600px]:my-3",children:[(0,s.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,s.jsxs)("ul",{className:"[&>li]:text-white list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,s.jsx)("li",{children:"此工具會根據玩家放在展示框的8個腳色身上的遺器做數據分析"}),(0,s.jsx)("li",{children:"翻盤機率是指該遺器透過重洗詞條道具後遺器分數變高的機率為何"}),(0,s.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等遺器"}),(0,s.jsx)("li",{children:"此工具相關數據仍有更改的可能，敬請見諒!"}),(0,s.jsxs)("li",{children:["操作說明可以參考",(0,s.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6065608",className:"!underline",children:"這篇"})]})]})]})},j=function(){let e=(0,r.useRef)(""),[a,x]=(0,r.useState)(void 0),[j,N]=(0,r.useState)(),[g,b]=(0,r.useState)(0),[D,y]=(0,r.useState)(void 0),[S,I]=(0,r.useState)(void 0),[k,R]=(0,r.useState)({color:void 0,rank:void 0}),[E,A]=(0,r.useState)(void 0),[C,H]=(0,r.useState)([]),T=(0,r.useRef)(null),{showStatus:F,updateStatus:_,hideStatus:P}=(0,v.Z)(),[O,B]=(0,r.useReducer)((e,a)=>{switch(a.type){case"CREATE":return{...e,historyData:[...a.payload]};case"ADD":let t=[...e.historyData];return console.log(t),{...e,historyData:t};case"LIMIT":return{...e,historyData:e.historyData.filter((e,a)=>0!==a)};case"DELETE":return{...e,historyData:e.historyData.filter((e,t)=>t!==a.payload)};case"UPDATE":let s=e.historyData.map((e,t)=>t===a.payload.index?{...e,...a.payload.newData}:e);return{...e,historyData:s};default:return e}},{historyData:[]}),{historyData:J=[]}=O,[M,U]=(0,r.useState)(void 0),[L,q]=(0,r.useState)([]),z=(0,r.useRef)([]),G=(0,o.usePathname)(),[Q,V]=(0,r.useState)(!0),[W,Y]=(0,r.useState)(!1),Z=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function $(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r="http://localhost:3000"===window.location.origin?"http://localhost:5000/relic/get":"https://expressapi-o9du.onrender.com/relic/get";if(!t){if(!/^\d+$/.test(e.current)||!e.current)return void _("請輸入有效的UID!!","error");if(!a)return void _("未選擇任何腳色!!","error");if(!L||0===L.length)return void _("至少選擇一項加權!!","error");t={uid:e.current,charID:a,partsIndex:7}}s||(s=L),Y(!1),F("正在尋找匹配資料......"),V(!1),y(void 0),R({color:void 0,rank:void 0}),A(void 0),I(void 0),N(),console.log(t),await n.A.post(r,t,{headers:{"Content-Type":"application/json"}}).then(async e=>{switch(console.log(e.data),e.data){case 800:_("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!","error"),V(!0);break;case 801:_("找不到該部件的遺器，如果是剛剛才更新的話建議等五分鐘再使用一次!!","error"),V(!0);break;case 802:_("該遺器等級尚未強化至滿等，請先強化至滿等後再嘗試!","error"),V(!0);break;case 803:_("該遺器非五星遺器，請選擇部位為五星強化滿等之遺器","error"),V(!0);break;case 804:_("該腳色並未穿著五星遺器！！","error"),V(!0);break;case 810:_("溝通次數太過於頻繁 請稍後再試!!","error"),V(!0);break;case 900:_("系統正在維護，請稍後再試!","error"),V(!0);break;default:await K(e.data,s)}}).catch(e=>{console.log(e),e.response&&429===e.response.status?_("請求次數過於頻繁，請稍後再試!!","error"):_("系統正在維護中 請稍後再試!!","error"),V(!0)})}async function K(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=[];for(let l of(console.log(s),s.forEach(e=>{if(""===e.value)return void _("加權指數不可為空或其他非法型式","error")}),e)){let e=await function(e,s){return new Promise(r=>{let l=new Worker(t.tu(new URL(t.p+t.u(587),t.b))),n=i.A.find(a=>a.fieldName===e.main_affix.type),c=[];e.sub_affix.forEach((e,a)=>{let t=i.A.find(a=>a.fieldName===e.type),s=t.percent?Number((100*e.value).toFixed(1)):Number(e.value.toFixed(1)),r={index:a,subaffix:t.name,data:s,count:e.count-1};c.push(r)});let o=c.includes(e=>"spd"===e.subaffix)?.5*L.find(e=>"速度"===e.name).value:0;c.forEach(e=>{"spd"!==e.subaffix&&0!==e.count&&(o+=.2)});let x={charID:a,MainData:n.name,SubData:c,partsIndex:e.type,standard:s,deviation:.5};F("數據計算處理中......"),l.postMessage(x),l.onmessage=function(a){r({relic:e,ExpRate:a.data.expRate,Rscore:a.data.relicscore,PieNums:a.data.returnData,Rank:a.data.relicrank,standDetails:s})}})}(l,s);r.push(e)}H(r),T.current=r,Y(!0)}(0,r.useEffect)(()=>{let e;null!==(e=JSON.parse(localStorage.getItem("importData")))&&(F("正在載入過往紀錄中......"),e=e.filter(e=>"1.4"===e.version),localStorage.setItem("importData",JSON.stringify(e)),null!=e&&e.length>0&&(B({type:"CREATE",payload:e}),_("先前紀錄已匯入!!","success"),console.log(e)))},[G]),(0,r.useEffect)(()=>{0!==C.length&&(N(C[g].relic),y(C[g].ExpRate),I(C[g].Rscore),_("資料顯示完畢","success"),A(C[g].PieNums),R(C[g].Rank),z.current=C[g].standDetails,V(!0))},[C,g]),(0,r.useEffect)(()=>{j&&requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[j]);let X=(0,r.useCallback)(e=>{H([...J[e].dataArr]),b(0),Y(!1),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[J]),ee=(0,r.useCallback)(async e=>{F("正在更新資料中");let a=J[e],t={uid:a.userID,charID:a.char.charID,partsIndex:7};await $(t,a.dataArr[0].standDetails).then(()=>{if(console.log(T.current),T.current){let t,s=0,r=0;T.current.forEach(e=>{s+=Number(e.Rscore),r+=e.ExpRate});let l=Number(parseFloat(s/T.current.length).toFixed(1)),i=new Date,n=Number((100*r/T.current.length).toFixed(1));Z.forEach(e=>{e.stand<=l&&void 0===t&&(t=e)});let c={version:"1.4",calDate:i.toISOString().split("T")[0],userID:a.userID,char:a.char,dataArr:T.current,avgScore:l,avgRank:t,avgRate:n};B({type:"UPDATE",payload:{index:e,newData:c}}),_("已更新","success"),Y(!1),J[e]=c,localStorage.setItem("importData",JSON.stringify(J))}}).catch(()=>{console.log("error")})},[J]),ea=(0,r.useCallback)(e=>{let a=J;B({type:"DELETE",payload:e}),a=a.filter((a,t)=>t!==e),localStorage.setItem("importData",JSON.stringify(a)),setTimeout(()=>{_("成功刪除該筆資料","success")},0)},[J]),et={charID:a,selfStand:L,partsIndex:7,standDetails:z.current,partArr:["Head 頭部","Hand 手部","Body 軀幹","Feet 腳部","Ball 位面球","Rope 連結繩"],historyData:J,isChangeAble:Q,RelicDataArr:C,relicIndex:g,relic:j,Rscore:S,Rrank:k,updateHistory:ea,checkDetails:X,updateDetails:ee,setCharID:x,setSelfStand:q,setIsSaveAble:Y,setStatusMsg:U,setRelicIndex:b};return(0,s.jsxs)(d.A.Provider,{value:et,children:[(0,s.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[90%]",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)("h1",{className:"text-red-600 font-bold text-2xl",children:"遺器匯入"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ImporterHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsxs)("div",{className:"flex flex-row flex-wrap ",children:[(0,s.jsxs)("div",{className:"flex flex-col w-2/5 max-[1250px]:w-[100%] min-w-[400px]",children:[(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"玩家UID :"})}),(0,s.jsx)("input",{type:"text",placeholder:"HSR UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:a=>e.current=a.target.value,disabled:!Q})]}),(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 max-[400px]:!flex-col items-center",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Characters 腳色:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(u.zj,{}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(u.mM,{}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"StandardHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-2 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===L.length?"hidden":""),children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"Params 參數:"})}),(0,s.jsx)(p.Q,{})]}),(0,s.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[400px]:justify-start",children:[(0,s.jsx)("button",{className:"processBtn",onClick:()=>$(),disabled:!Q,children:"開始匹配"}),(0,s.jsx)("button",{className:"processBtn",onClick:()=>(function(){let t,s=l.A.find(e=>e.charID===a);if(J.length>=6&&B({type:"LIMIT"}),0===C.length)return void _("當前沒有任何數據，不予儲存!!","error");if(!e.current)return void _("沒有輸入玩家ID，請再試一次!!","error");if(!a)return void _("沒有選擇任何腳色!!","error");let r=0,i=0;C.forEach(e=>{r+=Number(e.Rscore),i+=e.ExpRate});let n=Number(parseFloat(r/C.length).toFixed(1)),c=new Date,o=Number((100*i/C.length).toFixed(1));Z.forEach(e=>{e.stand<=n&&void 0===t&&(t=e)});let x={version:"1.4",calDate:c.toISOString().split("T")[0],userID:e.current,char:s,dataArr:C,avgScore:n,avgRank:t,avgRate:o};B({type:"ADD",payload:x}),_("已儲存","error"),Y(!1),J.push(x),localStorage.setItem("importData",JSON.stringify(J))})(),disabled:!W,children:"儲存紀錄"})]})]}),(0,s.jsxs)("div",{className:"w-3/5 ".concat(0===J.length?"hidden":""," flex-wrap max-[1250px]:w-[100%]"),children:[(0,s.jsxs)("div",{className:"flex flex-row items-baseline",children:[(0,s.jsx)("span",{className:"text-red-600 text-lg font-bold",children:"過往紀錄"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsx)("div",{className:"h-[300px] overflow-y-scroll hiddenScrollBar flex flex-row flex-wrap max-[600px]:!flex-col max-[600px]:!flex-nowrap",children:(0,s.jsx)(h,{})})]})]}),(0,s.jsxs)("div",{className:"flex flex-row flex-wrap w-[100%] border-t-4 border-gray-600 ".concat(void 0===E?"hidden":""),children:[(0,s.jsx)("div",{className:"w-[100%] ".concat(void 0===E?"hidden":""),children:(0,s.jsx)(u.aY,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/4  max-[700px]:w-[50%] ".concat(void 0===E?"hidden":""," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,s.jsx)(f.G,{mode:"Importer",button:!0})}),(0,s.jsx)("div",{className:"mt-3 w-1/4 max-[700px]:w-[50%] ".concat(void 0===E?"hidden":""," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,s.jsx)(p.V,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/2 max-[700px]:w-[100%] ".concat(E?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),id:"resultDetails",children:(0,s.jsx)(m.A,{ExpRate:D,Rscore:S,Rrank:k,PieNums:E})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.m_,{id:"CharHint",place:"right-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,s.jsx)("span",{className:"text-white",children:"例如:Jingliu→鏡流"})]})}),(0,s.jsx)(c.m_,{id:"StandardHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"根據個人需求"}),(0,s.jsx)("span",{className:"text-yellow-400",children:"選擇不重複的詞條種類(包含主詞條)"}),(0,s.jsx)("span",{className:"!text-red-500",children:'"有效詞條"選擇最多保有6個。'})]})}),(0,s.jsx)(c.m_,{id:"HistoryHint",place:"top-center",render:()=>(0,s.jsxs)("div",{className:"flex flex-col max-w-[250px] p-1",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"text-white",children:"此區塊可以查看過往查詢紀錄，下面為個別功能相關簡述。"})}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,s.jsx)("span",{className:"text-md font-bold text-white",children:"檢視"}),(0,s.jsx)("span",{children:"可以查看曾經查詢出來的資訊、包括遺器、評分標準等"})]}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"text-white font-bold",children:"更新"})}),(0,s.jsx)("div",{children:(0,s.jsx)("span",{children:"點選後會根據該紀錄原本的參數再查詢一次，並且將新結果更新至掉該筆紀錄中。"})})]}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"text-md font-bold text-white",children:"刪除"})}),(0,s.jsx)("div",{children:(0,s.jsx)("span",{children:"刪除該筆紀錄"})})]}),(0,s.jsxs)("div",{className:"mt-2 flex flex-col",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"text-md font-bold text-white",children:"注意事項"})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"!text-red-500",children:'"過往紀錄"最多只保留6筆'}),(0,s.jsx)("span",{className:"!text-yellow-500",children:"如果在已有6筆資料的情況再新增，則會從最舊的紀錄開始覆蓋掉"})]})]})]})}),(0,s.jsx)(c.m_,{id:"RelicSelectHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有遺器"}),(0,s.jsx)("span",{children:"點選遺器即可查看個別資訊"}),(0,s.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等遺器遺器"})]})}),(0,s.jsx)(c.m_,{id:"ImporterHint",place:"right-start",render:()=>(0,s.jsx)(w,{}),clickable:!0})]})]})}},7493:(e,a,t)=>{Promise.resolve().then(t.bind(t,1233))}},e=>{var a=a=>e(e.s=a);e.O(0,[8,935,668,899,282,310,441,684,358],()=>a(7493)),_N_E=e.O()}]);