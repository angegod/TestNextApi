(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{2589:(e,t,a)=>{Promise.resolve().then(a.bind(a,9875))},9875:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var s=a(5155),l=a(2115),r=a(2540),i=a(7665);a(9193);var n=a(3464),c=a(5424),x=a(5695),o=a(9796);let d=l.memo(e=>{let{context:t}=e,{historyData:a}=(0,l.useContext)(t);if(0===a.length)return(0,s.jsx)(s.Fragment,{});{let e=a.map((e,a)=>(0,s.jsx)(o.r,{index:a,data:e,context:t},"history"+a));return(0,s.jsx)(s.Fragment,{children:e})}});var h=a(7901),m=a(8390),p=a(2887),f=a(3848);let u=(0,l.createContext)(),w=function(){let e=(0,l.useRef)(""),[t,o]=(0,l.useState)(void 0),[w,j]=(0,l.useState)(),[v,N]=(0,l.useState)(0),g=(0,x.usePathname)(),[b,y]=(0,l.useState)(void 0),[D,S]=(0,l.useState)(void 0),[k,I]=(0,l.useState)({color:void 0,rank:void 0}),[R,E]=(0,l.useState)(void 0),[A,C]=(0,l.useState)([]),[H,T]=(0,l.useReducer)((e,t)=>{switch(t.type){case"CREATE":return{...e,historyData:[...t.payload]};case"ADD":let a=[...e.historyData];return console.log(a),{...e,historyData:a};case"LIMIT":return{...e,historyData:e.historyData.filter((e,t)=>0!==t)};case"DELETE":return{...e,historyData:e.historyData.filter((e,a)=>a!==t.payload)};default:return e}},{historyData:[]}),{historyData:_=[]}=H,[F,P]=(0,l.useState)(void 0),[B,M]=(0,l.useState)([]),O=(0,l.useRef)([]),[J,L]=(0,l.useState)({}),[U,q]=(0,l.useState)(!0),[z,G]=(0,l.useState)(!1),Q=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function V(){if(!/^\d+$/.test(e.current)||!e.current){alert("The UID is not vaild"),P("請輸入有效的UID!!");return}if(!t){alert("請輸入要查詢的腳色"),P("未選擇任何腳色");return}let a="http://localhost:3000"===window.location.origin?"http://localhost:5000/relic/get":"https://expressapi-o9du.onrender.com/relic/get",s={uid:e.current,charID:t,partsIndex:7};G(!1),P("正在尋找匹配資料......"),q(!1),y(void 0),I({color:void 0,rank:void 0}),E(void 0),S(void 0),j(),await n.A.post(a,s,{headers:{"Content-Type":"application/json"}}).then(e=>{switch(console.log(e.data),e.data){case 800:P("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!"),q(!0);break;case 801:P("找不到該部件的遺器，如果是剛剛才更新的話建議等五分鐘再使用一次!!"),q(!0);break;case 802:P("該遺器等級尚未強化至滿等，請先強化至滿等後再嘗試"),q(!0);break;case 803:P("該遺器非五星遺器，請選擇部位為五星強化滿等之遺器"),q(!0);break;case 804:P("該腳色並未穿著五星遺器！！"),q(!0);break;case 810:alert("溝通次數太過於頻繁 請稍後再試!!");break;default:W(e.data)}}).catch(e=>{console.log(e),e.response?429===e.response.status?P("請求次數過於頻繁，請稍後再試!!"):P("系統正在維護中 請稍後再試!!"):P("發生錯誤請稍後再試!!"),q(!0)})}async function W(e){let s=[];for(let l of(B.forEach(e=>{if(""===e.value)return void P("加權指數不可為空或其他非法型式")}),e)){let e=await function(e){return new Promise(s=>{let l=new Worker(a.tu(new URL(a.p+a.u(301),a.b))),r=i.A.find(t=>t.fieldName===e.main_affix.type),n=[];e.sub_affix.forEach((e,t)=>{let a=i.A.find(t=>t.fieldName===e.type),s=a.percent?Number((100*e.value).toFixed(1)):Number(e.value.toFixed(1)),l={index:t,subaffix:a.name,data:s,count:e.count-1};n.push(l)});let c=n.includes(e=>"spd"===e.subaffix)?.5*B.find(e=>"速度"===e.name).value:0;n.forEach(e=>{"spd"!==e.subaffix&&0!==e.count&&(c+=.2)});let x={charID:t,MainData:r.name,SubData:n,partsIndex:e.type,standard:B,deviation:.5};P("數據計算處理中......"),l.postMessage(x),l.onmessage=function(t){s({relic:e,ExpRate:t.data.expRate,Rscore:t.data.relicscore,PieNums:t.data.returnData,Rank:t.data.relicrank,standDetails:B})}})}(l);s.push(e)}console.log(s),C(s)}(0,l.useEffect)(()=>{let e;null!==(e=JSON.parse(localStorage.getItem("importData")))&&(e=e.filter(e=>"1.4"===e.version),localStorage.setItem("importData",JSON.stringify(e)),null!=e&&e.length>0&&(T({type:"CREATE",payload:e}),P("先前紀錄已匯入!!"),console.log(e)))},[g]),(0,l.useEffect)(()=>{0!==A.length&&(console.log(A),j(A[v].relic),y(A[v].ExpRate),S(A[v].Rscore),P("計算完畢!!"),E(A[v].PieNums),I(A[v].Rank),O.current=A[v].standDetails,G(!0),L({}),q(!0),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}))},[A,v]);let Y=(0,l.useCallback)(e=>{C(_[e].dataArr),N(0),L({}),P("資料替換完畢!!"),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[_]),$=(0,l.useCallback)(e=>{let t=_;T({type:"DELETE",payload:e}),t=t.filter((t,a)=>a!==e),localStorage.setItem("importData",JSON.stringify(t)),P("正在處理中....."),setTimeout(()=>{P("成功刪除該紀錄!!")},0)},[_]),K={charID:t,selfStand:B,partsIndex:7,standDetails:O.current,partArr:["Head 頭部","Hand 手部","Body 軀幹","Feet 腳部","Ball 位面球","Rope 連結繩"],historyData:_,isChangeAble:U,simulatorData:J,RelicDataArr:A,relicIndex:v,relic:w,Rscore:D,Rrank:k,updateHistory:$,checkDetails:Y,setCharID:o,setSelfStand:M,setIsSaveAble:G,setStatusMsg:P,setRelicIndex:N};return(0,s.jsxs)(u.Provider,{value:K,children:[(0,s.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[90%]",children:[(0,s.jsx)("h1",{className:"text-red-500 font-bold text-2xl",children:"遺器匯入"}),(0,s.jsxs)("div",{className:"flex flex-row flex-wrap ",children:[(0,s.jsxs)("div",{className:"flex flex-col w-1/2 max-[900px]:w-[100%]",children:[(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"玩家UID :"})}),(0,s.jsx)("input",{type:"text",placeholder:"HSR UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:t=>e.current=t.target.value,disabled:!U})]}),(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 max-[400px]:!flex-col items-center",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Characters 腳色:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(f.zj,{context:u}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(f.mM,{context:u}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"StandardHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-2 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===B.length?"hidden":""),children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"Params 參數:"})}),(0,s.jsx)(m.Q,{context:u})]}),(0,s.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[400px]:justify-start",children:[(0,s.jsx)("button",{className:"processBtn",onClick:()=>V(),disabled:!U,children:"開始匹配"}),(0,s.jsx)("button",{className:"processBtn",onClick:()=>(function(){let a,s=r.A.find(e=>e.charID===t);if(_.length>=6&&T({type:"LIMIT"}),0===A.length)return void P("當前沒有任何數據，不予儲存!!");if(!e.current)return void P("沒有輸入玩家ID，請再試一次!!");if(!t)return void P("沒有選擇任何腳色!!");let l=0,i=0;A.forEach(e=>{l+=Number(e.Rscore),i+=e.ExpRate});let n=Number(parseFloat(l/A.length).toFixed(1)),c=new Date,x=Number((100*i/A.length).toFixed(1));Q.forEach(e=>{e.stand<=n&&void 0===a&&(a=e)});let o={version:"1.4",calDate:c.toISOString().split("T")[0],userID:e.current,char:s,dataArr:A,avgScore:n,avgRank:a,avgRate:x};T({type:"ADD",payload:o}),P("已儲存"),G(!1),_.push(o),localStorage.setItem("importData",JSON.stringify(_))})(),disabled:!z,children:"儲存紀錄"})]})]}),(0,s.jsxs)("div",{className:"w-1/2 max-w-[400px] flex flex-col max-[900px]:w-[100%] max-[600px]:my-3",children:[(0,s.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,s.jsxs)("ul",{className:"[&>li]:text-white list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,s.jsx)("li",{children:"此工具會根據玩家放在展示框的8個腳色身上的遺器做數據分析"}),(0,s.jsx)("li",{children:"翻盤機率是指該遺器透過重洗詞條道具後遺器分數變高的機率為何"}),(0,s.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等遺器"}),(0,s.jsx)("li",{children:"此工具相關數據仍有更改的可能，敬請見諒!"}),(0,s.jsxs)("li",{children:["操作說明可以參考",(0,s.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6065608",className:"!underline",children:"這篇"})]})]})]})]}),(0,s.jsxs)("div",{className:"".concat(0===_.length?"hidden":""," flex-wrap max-[930px]:w-[100%] border-t-4 border-gray-600 p-2 my-4 "),children:[(0,s.jsxs)("div",{className:"flex flex-row items-baseline",children:[(0,s.jsx)("span",{className:"text-red-500 text-lg font-bold",children:"過往紀錄"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsx)("div",{className:"h-[300px] overflow-y-scroll hiddenScrollBar flex flex-row flex-wrap max-[600px]:!flex-col max-[600px]:!flex-nowrap",children:(0,s.jsx)(d,{context:u})})]}),(0,s.jsxs)("div",{className:"flex flex-row flex-wrap w-[100%] border-t-4 border-gray-600",children:[(0,s.jsx)("div",{className:"w-[100%] ".concat(void 0===R?"hidden":""),children:(0,s.jsx)(f.aY,{context:u})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/4  max-[700px]:w-[50%] ".concat(void 0===R?"hidden":""," max-[400px]:w-[90%]"),children:(0,s.jsx)(p.G,{context:u,mode:"Importer",button:!0})}),(0,s.jsx)("div",{className:"mt-3 w-1/4 max-[700px]:w-[50%] ".concat(void 0===R?"hidden":""," max-[400px]:w-[90%]"),children:(0,s.jsx)(m.V,{context:u})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/2 max-[700px]:w-[100%] ".concat(void 0===F?"hidden":""),id:"resultDetails",children:(0,s.jsx)(h.A,{ExpRate:b,Rscore:D,statusMsg:F,Rrank:k,PieNums:R})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.m_,{id:"CharHint",place:"right-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,s.jsx)("span",{className:"text-white",children:"例如:Jingliu→鏡流"})]})}),(0,s.jsx)(c.m_,{id:"StandardHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"根據個人需求"}),(0,s.jsx)("span",{className:"text-yellow-400",children:"選擇不重複的詞條種類(包含主詞條)"}),(0,s.jsx)("span",{className:"!text-red-500",children:'"有效詞條"選擇最多保有6個。'})]})}),(0,s.jsx)(c.m_,{id:"HistoryHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:'"檢視"可以查看曾經查詢出來的資訊'}),(0,s.jsx)("span",{children:'"刪除"則會刪除該筆紀錄'}),(0,s.jsx)("span",{className:"!text-red-500",children:'"過往紀錄"最多只保留6筆'}),(0,s.jsx)("span",{className:"!text-yellow-500",children:"如果在已有6筆資料的情況再新增，則會從最舊的紀錄開始覆蓋掉"})]})}),(0,s.jsx)(c.m_,{id:"RelicSelectHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有遺器"}),(0,s.jsx)("span",{children:"點選遺器即可查看個別資訊"}),(0,s.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等遺器遺器"})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8,668,471,464,282,41,441,684,358],()=>t(2589)),_N_E=e.O()}]);